<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">

</head>
<style>
  #calculator {
    display: flex;
    flex-direction: column;
    background: url(/image/orzel.jpg) 50% no-repeat;
    background-position: top right;
    background-size: 150px;
    margin: 15%;
  }

  .inputs input {
    margin: 5px 0;
    box-sizing: content-box;
    padding: 5px 10px;
    border: 5px solid #932727;
    -webkit-border-radius: 50px;
    border-radius: 50px;
    font: italic normal normal 16px/normal "Comic Sans MS", cursive, sans-serif;
  }
</style>

<body>
  <div id="calculator">
    <div class="inputs">
      <input type="text" id="entredValue"> <span>Ввод</span>
    </div>
    <div class="inputs">
      <input type="text" id="outputRPN" disabled> <span>Обратная польская запись</span>
    </div>
    <div class="inputs">
      <input type="text" id="resualt" disabled> <span>Результат</span>
    </div>
    <div class="inputs">
      <input type="text" id="warnings" disabled> <span> Предупреждение </span>
    </div>
    <button id="btnRes">Расчет</button>
  </div>
</body>

<script>

  const Calculator = function () {
    // do code here
    // remake my first course work in university 
    // i had the same task on delphi 
    // i called her poland calulator 
    const MathSymbols = new Set("+").add("-").add("*").add("/").add("(").add(")");

    const Arithmetic = {
      "+": 1,
      "-": 1,
      "*": 2,
      "/": 2,
      "(": 0
    }

    let numbers = [];
    let opers = [];

    function negativeNumber(str) {
      if (str[0] == '-') str = '0' + str;
      str = str.split('');
      for (let i = 0; i < str.length; i++) {
        if ((str[i] == '(') && (str[i + 1] == '-')) {
          str.splice(i + 1, 0, '0');
        }
      };
      return str.join('');
    };

    function createRpn(str) {
      let split = false;
      let rpn = '';
      for (let i = 0; i < str.length; i++) {

        if (!MathSymbols.has(str[i])) {// if it is number, not Math symbol!
          if (split && (rpn.length != 0)) rpn += ' '; //  add space, creates a number from digits   
          rpn += str[i]; // add digits to string
          split = false; // end enter of number

        } else {
          split = true; // split on numbers

          if (str[i] == "(") { // delete parentheses 
            opers.push(str[i]); // add new operand 
          } else if (str[i] == ")") {

            while (opers[opers.length - 1] != '(') {
              if (rpn.length == 0) {
                rpn += opers.pop(); // add all operands in stack
              } else {
                rpn += ' ' + opers.pop();
              }
            }// end while
            opers.pop();// drop "("
            //end parentheses 
          } else if (MathSymbols.has(str[i])) {// comparing priorities

            if (!opers.length) {// opers is empty 
              opers.push(str[i]);
            } else if (Arithmetic[[str[i]]] > Arithmetic[opers[opers.length - 1]]) {
              // if currient priority higher than
              // priority symblol on the top of the stack         
              opers.push(str[i]);
            } else {
              rpn += " " + opers.pop();
              while (Arithmetic[opers[opers.length - 1]] >= Arithmetic[[str[i]]]) {
                rpn += " " + opers.pop();
                //while symbols on the top of the stack higher than
                //currient symbol str[i]
                //add in rpn string
              }
              opers.push(str[i]);// add new symbol on the top of the stack
            }

          }// end comparing priorities
        }
      };
      while (opers.length) rpn += ' ' + opers.pop();
      //console.log(rpn);
      outputRPN.value = rpn;
      return rpn;
    }
    function operation(x) {
      let r2 = numbers.pop();
      let r1 = numbers.pop();
      // console.log(`${r1} ${x} ${r2}`)
      let res;
      switch (x) {
        case '+':
          res = r1 + r2;
          break;
        case '-':
          res = r1 - r2;
          break;
        case '*':
          res = r1 * r2;
          break
        case '/':
          if (r2 == 0) {
            warnings.value = `деление на 0 запрещено`;
            setTimeout(() => {
              warnings.value = "";
            }, 2000);
          }
          res = r1 / r2;
          break;
      }
      numbers.push(res);
    }
    function calculate(str) {
      let arr = str.split(' ');// create array from RPZ string 
      for (let i = 0; i < arr.length; i++) {
        if (isNaN(arr[i])) {
          operation(arr[i]);// do arithmetic operation
        } else {
          numbers.push(+arr[i]);// add number to stack
        }
      }
      return numbers.pop();// last number in stack is resualt
    };
    this.evaluate = string => {
      string = string.replace(/\s/g, '');
      string = negativeNumber(string);
      string = createRpn(string);
      return calculate(string);
    }
  };


  let calc = new Calculator();

  btnRes.onclick = function () {
    resualt.value = calc.evaluate(entredValue.value);
  };
</script>


</html>